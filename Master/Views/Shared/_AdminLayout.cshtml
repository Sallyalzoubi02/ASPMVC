<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>داشبورد Success</title>
    <!-- Bootstrap RTL CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="~/css/Admin.css" />
    @RenderSection("Styles", required: false)

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

    <link href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css" rel="stylesheet" />
</head>
<body>
    <div class="animated-bg"></div>

    <!-- زر القائمة للموبايل -->
    <button class="mobile-menu-btn" id="mobileMenuBtn">
        <i class="fas fa-bars"></i>
    </button>

    <div class="d-flex">
        <!-- Sidebar -->
        <div class="sidebar col-md-3 col-lg-2 p-4" id="sidebar">
            <div class="d-flex flex-column h-100">
                <img class="align-self-center" src="~/image/أثـر-removebg-preview (1) 2.png" alt="Logo" width="60%" />

                <ul class="nav nav-pills flex-column mb-auto">
                    <li class="nav-item">
                        <a asp-action="Index" class="nav-link @(ViewContext.RouteData.Values["Action"].ToString() == "Index" ? "active" : "")" id="home-link">
                            <i class="fas fa-home"></i>
                            الرئيسية
                        </a>
                    </li>

                    <!-- تبويب الأصناف والمنتجات -->
                    <li class="nav-item">
                        <a href="#products-collapse" class="nav-link @(ViewContext.RouteData.Values["Action"].ToString() == "Products" || ViewContext.RouteData.Values["Action"].ToString() == "Category" ? "active" : "")" data-bs-toggle="collapse" aria-expanded="@(ViewContext.RouteData.Values["Action"].ToString() == "Products" || ViewContext.RouteData.Values["Action"].ToString() == "Category" ? "true" : "false")">
                            <i class="fas fa-boxes"></i>
                            إدارة المحتوى
                        </a>
                        <div class="collapse @(ViewContext.RouteData.Values["Action"].ToString() == "Products" || ViewContext.RouteData.Values["Action"].ToString() == "Category" ? "show" : "")" id="products-collapse">
                            <ul class="nav nav-pills flex-column ps-4">
                                <li class="nav-item">
                                    <a asp-action="Products" class="nav-link @(ViewContext.RouteData.Values["Action"].ToString() == "Products" ? "active" : "")" id="products-link">
                                        <i class="fas fa-box-open"></i>
                                        المنتجات
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a asp-action="Category" class="nav-link @(ViewContext.RouteData.Values["Action"].ToString() == "Category" ? "active" : "")" id="category-link">
                                        <i class="fas fa-tags"></i>
                                        الأصناف
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </li>

                    <!-- تبويب العمال -->
                    <li class="nav-item">
                        <a href="#workers-collapse" class="nav-link @(ViewContext.RouteData.Values["Action"].ToString() == "EmploymentApplication" || ViewContext.RouteData.Values["Action"].ToString() == "VolunteerApplication" ? "active" : "")" data-bs-toggle="collapse" aria-expanded="@(ViewContext.RouteData.Values["Action"].ToString() == "EmploymentApplication" || ViewContext.RouteData.Values["Action"].ToString() == "VolunteerApplication" ? "true" : "false")">
                            <i class="fas fa-users-cog"></i>
                            العمال
                        </a>
                        <div class="collapse @(ViewContext.RouteData.Values["Action"].ToString() == "EmploymentApplication" || ViewContext.RouteData.Values["Action"].ToString() == "VolunteerApplication" ? "show" : "")" id="workers-collapse">
                            <ul class="nav nav-pills flex-column ps-4">
                                <li class="nav-item">
                                    <a asp-action="EmploymentApplication" class="nav-link @(ViewContext.RouteData.Values["Action"].ToString() == "EmploymentApplication" ? "active" : "")" id="employment-link">
                                        <i class="fas fa-briefcase"></i>
                                        توظيف
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a asp-action="VolunteerApplication" class="nav-link @(ViewContext.RouteData.Values["Action"].ToString() == "VolunteerApplication" ? "active" : "")" id="volunteering-link">
                                        <i class="fas fa-hands-helping"></i>
                                        تطوع
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </li>

                    <!-- تبويب العملاء والخصومات -->
                    <li class="nav-item">
                        <a href="#customers-collapse" class="nav-link @(ViewContext.RouteData.Values["Action"].ToString() == "Users" || ViewContext.RouteData.Values["Action"].ToString() == "Discounts" ? "active" : "")" data-bs-toggle="collapse" aria-expanded="@(ViewContext.RouteData.Values["Action"].ToString() == "Users" || ViewContext.RouteData.Values["Action"].ToString() == "Discounts" ? "true" : "false")">
                            <i class="fas fa-users"></i>
                            العملاء
                        </a>
                        <div class="collapse @(ViewContext.RouteData.Values["Action"].ToString() == "Users" || ViewContext.RouteData.Values["Action"].ToString() == "Voucher" ? "show" : "")" id="customers-collapse">
                            <ul class="nav nav-pills flex-column ps-4">
                                <li class="nav-item">
                                    <a asp-action="Users" class="nav-link @(ViewContext.RouteData.Values["Action"].ToString() == "Users" ? "active" : "")" id="users-link">
                                        <i class="fas fa-user-friends"></i>
                                        العملاء
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a asp-action="Voucher" class="nav-link @(ViewContext.RouteData.Values["Action"].ToString() == "Voucher" ? "active" : "")" id="discounts-link">
                                        <i class="fas fa-percentage"></i>
                                        الخصومات
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </li>

                    <li class="nav-item">
                        <a asp-action="Recycling" class="nav-link @(ViewContext.RouteData.Values["Action"].ToString() == "Recycling" ? "active" : "")" id="recycling-link">
                            <i class="fa-solid fa-recycle"></i>
                            التدوير
                        </a>
                    </li>
                    <li class="nav-item">
                        <a asp-action="Subscription" class="nav-link @(ViewContext.RouteData.Values["Action"].ToString() == "Subscription" ? "active" : "")" id="subscription-link">
                            <i class="fa-solid fa-star"></i>
                            الاشتراكات
                        </a>
                    </li>
                    <li class="nav-item">
                        <a asp-action="Orders" class="nav-link @(ViewContext.RouteData.Values["Action"].ToString() == "Orders" ? "active" : "")" id="orders-link">
                            <i class="fas fa-chart-bar"></i>
                            طلبات
                        </a>
                    </li>
                    <li class="nav-item">
                        <a asp-action="Payment" class="nav-link @(ViewContext.RouteData.Values["Action"].ToString() == "Payment" ? "active" : "")" id="payment-link">
                            <i class="fas fa-file-invoice-dollar"></i>
                            الفواتير
                        </a>
                    </li>

                    <li class="nav-item">
                        <a class="nav-link @(ViewContext.RouteData.Values["Action"]?.ToString() == "Messages" ? "active" : "")"
                           asp-controller= "Admin" asp-action="Messages" id="Messages-link">
                            <i class="fas fa-message"></i>

                            الرسائل
                            @if (ViewBag.UnreadMessagesCount > 0)
                            {
                                <span class="badge bg-warning">@ViewBag.UnreadMessagesCount</span>
                            }
                        </a>
                    </li>

                    <li class="nav-item">
                        <a asp-action="logout" class="nav-link" id="logout-link">
                            <i class="fa-solid fa-right-from-bracket"></i>
                            تسجيل الخروج
                        </a>
                    </li>
                </ul>

            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content col-md-9 col-lg-10">
            @Html.AntiForgeryToken()
            @RenderBody()
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>

    <script>
        // أنيميشن الخلفية
        function createAnimatedCircles() {
            const animatedBg = document.querySelector('.animated-bg');
            for (let i = 0; i < 15; i++) {
                const circle = document.createElement('div');
                circle.classList.add('circle');

                const size = Math.random() * 100 + 50;
                const posX = Math.random() * window.innerWidth;
                const delay = Math.random() * 15;
                const duration = Math.random() * 20 + 10;

                circle.style.width = `${size}px`;
                circle.style.height = `${size}px`;
                circle.style.left = `${posX}px`;
                circle.style.animationDelay = `${delay}s`;
                circle.style.animationDuration = `${duration}s`;

                animatedBg.appendChild(circle);
            }
        }

        // إدارة القائمة على الموبايل
        document.addEventListener('DOMContentLoaded', function() {
            createAnimatedCircles();

            const mobileMenuBtn = document.getElementById('mobileMenuBtn');
            const sidebar = document.getElementById('sidebar');

            // فتح/إغلاق القائمة
            mobileMenuBtn.addEventListener('click', function() {
                sidebar.classList.toggle('show-sidebar');
            });

            // إغلاق القائمة عند النقر خارجها
            document.addEventListener('click', function(e) {
                if (!sidebar.contains(e.target) && e.target !== mobileMenuBtn) {
                    sidebar.classList.remove('show-sidebar');
                }
            });
        });
    </script>

    <script>
        // تحديث عدد الرسائل كل 30 ثانية
        setInterval(async () => {
            const response = await fetch('/Admin/GetUnreadMessagesCount');
            const count = await response.json();
            const badge = document.querySelector('#Messages-link .badge');

            if (count > 0) {
                badge?.remove();
                document.querySelector('#Messages-link').insertAdjacentHTML('beforeend',
                    `<span class="badge bg-warning">${count}</span>`);
            } else {
                badge?.remove();
            }
        }, 30000);
    </script>

    @RenderSection("Scripts", required: false)
</body>
</html>